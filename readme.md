# Как сделать бота для телеграма. 
Каждый шаг этой инструкции соответствует одному из коммитов в данном репозитории.
1. Бот, работающий локально (первый коммит)
   1. Создадим пустого бота с помощью @BotFather - зададим ему имя и получим токен (ключ доступа)
   1. Установим питоновскую библиотеку `pytelegrambotapi`, с удобной обёрткой для телеграма. Это можно сделать, 
      например, с помощью пакетного менеджера `pip`. Все установленные библиотеки будем записывать в `requirements.txt`,
      чтобы потом они автоматически устанавливались на сервере. 
   1. Создадим файл `main.py` с примитивным ботом-повторюшкой. При запуске файла пароль от бота читается из переменных
      среды (чтобы не палить его в репозитории), создаются функции для ответа на сообщения, и бот запускается в режиме
      "polling" (когда ваша программа постоянно спрашивает Телеграм, нет ли обновлений)
   1. Чтобы протестировать его, надо вписать пароль в переменные среды (вбить в командной строке`set TOKEN=...` на винде 
      или `export TOKEN=...` на маке и линуксе), а дальше запустить в командной строке `python main.py` (предварительно
      перейдя в с помощью `cd` в папку с кодом) - и бот заработает!
1. Запуск бота на сервере heroku (второй коммит)
   1. Зарегистрируемся на heroku.com и создадим пустое приложение (я назвал его `example-telebot`). 
   1. Привяжем приложение к вашему репозиторию с ботом на гитхабе [скриншот](screenshots/heroku_register.png). Если ещё
      потом и поставить галочку "Enable automatic deploys", то бот будет перезапускаться на heroku после каждого коммита
      автоматически.
   1. Чтобы heroku знал, что именно надо запускать, создадим для него файл Procfile с единственной строчкой 
      `web: python main.py`
   1. Для продакшна режим polling не годится (неэффективен и частенько ломается), но на сервере бота можно запускать в
      другом режиме, "webhook", когда Telegram сам обращается к вашему серверу. Для этого сервер должен уметь
      обрабатывать запросы; мы добьемся этого, используя фреймворк Flask. Установим его также с помощью `pip`.
   1. Допишем файл `main.py`: теперь кроме бота появляется объект server, который передаёт сообщения боту в функции
      `get_message`. 
   1. Сам сервер имеет смысл запускать только на heroku, поэтому мы будем выбирать между режимами webhook и polling
      в зависимости от аргумента командной строки `poll`. То есть теперь, чтобы запустить бота не на heroku, а на 
      своем компьютере, нужно будет писать `python main.py --polling`
   1. Чтобы на heroku бот мог получить токен, его надо добавить в переменные среды heroku, 
      [примерно так](screenshots/heroku_variables.png).
   1. Теперь можно коммитить и пушить изменения, и за пару минут они приедут на heroku, и бот заработает оттуда. 